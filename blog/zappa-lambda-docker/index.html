<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="generator" content="Docusaurus">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="metadefi - Decentralized Finance Data Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="metadefi - Decentralized Finance Data Blog Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-136383172-2","auto"),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<link rel="stylesheet" href="https://use.typekit.net/ckb0rsm.css">
<link rel="stylesheet" href="https://at-ui.github.io/feather-font/css/iconfont.css">
<link rel="stylesheet" href="">

<title data-react-helmet="true">Deploying machine learning models to AWS Lambda, with Connexion, Zappa and Docker | metadefi - Decentralized Finance Data</title>

<meta data-react-helmet="true" http-equiv="x-ua-compatible" content="ie=edge"><meta data-react-helmet="true" property="og:title" content="Deploying machine learning models to AWS Lambda, with Connexion, Zappa and Docker | metadefi - Decentralized Finance Data"><meta data-react-helmet="true" name="description" content="We are gonna learn how to easily deploy any Python3 application to AWS lambda without having to change any code or even go into the lambda console. "><meta data-react-helmet="true" property="og:description" content="We are gonna learn how to easily deploy any Python3 application to AWS lambda without having to change any code or even go into the lambda console. "><meta data-react-helmet="true" property="og:image" content="https://metadefi.com/img/open-graph.png"><meta data-react-helmet="true" property="twitter:image" content="https://metadefi.com/img/open-graph.png"><meta data-react-helmet="true" name="twitter:image:alt" content="Image for Deploying machine learning models to AWS Lambda, with Connexion, Zappa and Docker | metadefi - Decentralized Finance Data"><meta data-react-helmet="true" name="twitter:card" content="summary">

<link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico">


<link rel="stylesheet" href="/styles.37b81589.css">

</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}function e(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}var n=window.matchMedia("(prefers-color-scheme: dark)");n.addListener((function(n){null===e()&&t(n.matches?"dark":"")}));var a=e();null!==a?t(a):n.matches&&t("dark")}()</script>
<div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top navbarHideable_2ZIa"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a aria-current="page" class="navbar__brand active" href="/"></a><a class="navbar__item navbar__link" href="/docs/">Top 100 projects</a></div><div class="navbar__items navbar__items--right"><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_16CL"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_keGJ moon_1gwN"></span></div><div class="react-toggle-track-x"><span class="toggle_keGJ sun_3CPA"></span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a aria-current="page" class="navbar__brand active" href="/"></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="navbar__item navbar__link" href="/docs/">Top 100 projects</a></li></ul></div></div></div></nav><div class="main-wrapper"><article class="blogPost_3zD9"><header class="hero domain-bg domain-bg--platforms header_1qzK"><div class="container headerContainer_2rhk"><div class="avatar avatar--lg avatar--vertical"><img class="avatar__photo avatar__photo--lg" src="https://github.com/gonwi.png"><div class="avatar__intro"><div class="avatar__name"><a href="https://github.com/gonwi" target="_blank" rel="author">Gonzalo</a> / <time pubdate="pubdate" datetime="2019-11-23T00:00:00.000Z">Nov 23rd</time> / 5 min read</div></div></div><h1>Deploying machine learning models to AWS Lambda, with Connexion, Zappa and Docker</h1><div class="headerTags_9qDx"><div class="tags_1Ys8"><a class="badge badge--rounded badge--pink" href="/blog/tags/type-tutorial/">type: tutorial</a><a class="badge badge--rounded badge--blue" href="/blog/tags/domain-platforms/">domain: platforms</a><a class="badge badge--rounded badge--primary" href="/blog/tags/platform-aws/">platform: aws</a></div></div></div></header><div class="container container--narrow container--bleed margin-vert--xl"><section class="markdown"><p><img src="https://cdn-images-1.medium.com/max/3840/1*TA00Ctroh-9eyrzej49Mag.png"></p><p>We are gonna learn how to easily deploy any Python3 application to AWS lambda without having to change any code or even go into the lambda console.</p><p><strong>Our proposed architecture.</strong></p><ul><li><p>Python 3. A popular programming language for data scientists.</p></li><li><p>Flask. A micro web framework, that works with little dependencies and libraries.</p></li><li><p><a href="https://swagger.io/docs/specification/2-0/basic-structure/">OpenAPI </a>2.0, formerly known as Swagger 2.0.</p></li><li><p>Zalando’s <a href="https://github.com/zalando/connexion">Connexion</a>. handles routes, requests and response validation automatically from OpenAPI definition.</p></li><li><p>Docker. Helps us</p><p>  cd micro-python
Start by downloading our boilerplate code application from github</p></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="meet-micropython-a-lightweight-api-microservice-designed-for-easy-deployment-we-open-sourced"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#meet-micropython-a-lightweight-api-microservice-designed-for-easy-deployment-we-open-sourced" title="Direct link to heading">#</a>Meet Micropython. A lightweight API microservice designed for easy deployment we open-sourced.</h2><p>Find source code <a href="https://github.com/BrainrexAPI/micropython">here</a>.</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_3ZcX"><pre class="prism-code language-undefined codeBlock_1wn8" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">git clone [https://github.com/BrainrexAPI/micropython.git](https://github.com/BrainrexAPI/micropython)</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1PCb">Copy</button></div></pre><p>Create a virtual environment.</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_3ZcX"><pre class="prism-code language-undefined codeBlock_1wn8" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">cd micro-python</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">virtualenv -m venv myenv</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">source venv/bin/activate</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1PCb">Copy</button></div></pre><p>Run the application <strong>locally</strong> to check everything is working.</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_3ZcX"><pre class="prism-code language-undefined codeBlock_1wn8" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">pip install -r requirements.txt</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">python app.py</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1PCb">Copy</button></div></pre><p>Open <a href="http://0.0.0.0:5000/ui">http://0.0.0.0:5000/ui</a> in a web browser and you should see this:</p><p>Now let’s deploy to Lambda if you haven’t set up your credentials locally. This is a fast way to do it. First, get authenticated. For the sake of simplicity of this tutorial we are gonna use very permissive permission ( DO NOT use these settings in production)</p><ul><li><p>Go to <strong>Console &gt; IAM &gt; Users &gt; Security Credentials &gt; Access Keys</strong></p></li><li><p>Download Access Keys CSV</p><p>  aws configure</p><p>  export AWS_DEFAULT_REGION=us-west-2
export AWS_PROFILE=default</p></li></ul><p>Build your Docker image from Dockerfile.</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_3ZcX"><pre class="prism-code language-undefined codeBlock_1wn8" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">$ docker build -t myimage .</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1PCb">Copy</button></div></pre><p>Now we create an alias for better reusability. This command runs the Docker image using your AWS_PROFILE as an argument. Then it uses the docker image you just pull</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_3ZcX"><pre class="prism-code language-undefined codeBlock_1wn8" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">alias micropyshell=&#x27;docker run -ti -e AWS_PROFILE=zappa -v $(pwd):/var/task -v ~/.aws/:/root/.aws  --rm myimage&#x27;</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1PCb">Copy</button></div></pre><p>Add alias to your bash_profile to be able to run command.</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_3ZcX"><pre class="prism-code language-undefined codeBlock_1wn8" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">alias micropyshell &gt;&gt; ~/.bash_profile</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1PCb">Copy</button></div></pre><p>Run the command you just created. This will run the docker image with your AWS configuration on it. Inside this image, we will still our dependencies and deploy to Lambda with Zappa.</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_3ZcX"><pre class="prism-code language-undefined codeBlock_1wn8" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">micropyshell</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1PCb">Copy</button></div></pre><p>Now you should be inside the docker container shell.</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_3ZcX"><pre class="prism-code language-undefined codeBlock_1wn8" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">micropyshell&gt;</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1PCb">Copy</button></div></pre><p>Let’s create a virtual enviroment inside container.</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_3ZcX"><pre class="prism-code language-undefined codeBlock_1wn8" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">virtualenv venv</span></div><div class="token-line" style="color:#393A34"><span class="token plain">source venv/bin/activate</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1PCb">Copy</button></div></pre><p>Install any python package inside your docker containers.</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_3ZcX"><pre class="prism-code language-undefined codeBlock_1wn8" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">pip install -r requirements.txt</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1PCb">Copy</button></div></pre><p>Deploy your services to Lambda. After you press this here is what happens after the scenes.</p><p>From Zappa docs. Credit: <a href="https://github.com/Miserlou/Zappa">https://github.com/Miserlou/Zappa</a></p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_3ZcX"><pre class="prism-code language-undefined codeBlock_1wn8" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">zappa deploy dev</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1PCb">Copy</button></div></pre><p>After you should be given an API gateway URL like this</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="troubleshooting"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#troubleshooting" title="Direct link to heading">#</a>Troubleshooting</h2><p><strong>Not finding config file</strong></p><p>botocore.exceptions.ProfileNotFound: The config profile (default) could not be found</p><p><img src="https://cdn-images-1.medium.com/max/2096/1*FIiGHxisqMGNswKg0gE7rg.png" alt="Error 1. Profile not found."></p><ul><li><strong>502. This could be an error when running your python program</strong></li></ul><p>Zappa tail to see your logs.</p><p>You can also see your logs in Cloudwatch by going to the API gateway.</p><ul><li><p><strong>500</strong></p><p>  &quot;slim_handler&quot;: true,
&quot;memory_size&quot;: 3008,</p></li><li><p><strong>Problems with NLTK Library.</strong></p></li></ul><p><strong>Solution: [</strong><a href="https://stackoverflow.com/questions/42382662/using-nltk-corpora-with-aws-lambda-functions-in-python">https://stackoverflow.com/questions/42382662/using-nltk-corpora-with-aws-lambda-functions-in-python</a>](<a href="https://stackoverflow.com/questions/42382662/using-nltk-corpora-with-aws-lambda-functions-in-python">https://stackoverflow.com/questions/42382662/using-nltk-corpora-with-aws-lambda-functions-in-python</a>)</p><p>Create a Enviroment Variable in the Lambda Console.</p><ul><li><strong>You are using python 2.7 It won’t work Check</strong></li></ul><p>python</p><p><strong>Here’s a weird one. Your package requires GPU</strong></p><ul><li><p>from thinc.neural.util import prefer_gpu, require_gpu</p></li><li><p>Answer: <a href="https://stackoverflow.com/questions/49186886/spacy-throws-oserror-when-deployed-to-aws-lambda-using-zappa">https://stackoverflow.com/questions/49186886/spacy-throws-oserror-when-deployed-to-aws-lambda-using-zappa</a></p></li></ul><p><strong>References</strong></p><p><a href="https://aws.amazon.com/blogs/machine-learning/how-to-deploy-deep-learning-models-with-aws-lambda-and-tensorflow/">https://aws.amazon.com/blogs/machine-learning/how-to-deploy-deep-learning-models-with-aws-lambda-and-tensorflow/</a></p></section><section class="panel bleed" style="text-align:center"><div class="mailingListTitle_2bf2"><i class="feather icon-mail"></i> Vector In Your Inbox!</div><p>One email on the 1st of the month. No spam, ever.</p><div class="mailing-list mailing-list--center mailing-list--lg"><form action="https://formspree.io/xqkevzld" method="post" class="mailing-list--form"><input type="email" class="input input--lg" name="email" placeholder="your@email.com"><button class="button button--primary button--lg" type="submit">Subscribe </button></form></div></section><div class="bleed margin-vert--xl"><nav class="pagination-nav"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/blog/libracamp-selected"><h5 class="pagination-nav__link--sublabel">Next Post</h5><h4 class="pagination-nav__link--label">Brainrex joins Libracamp, a boot camp to build on Facebook’s backed cryptocurrency project »</h4></a></div></nav></div></div></article></div><footer class="footer"><div class="container"><div class="row footer__links"><div class="col col--5 footer__col"><div class="margin-bottom--md"></div><div class="margin-bottom--md"><div class="mailing-list"><form action="https://formspree.io/xqkevzld" method="post" class="mailing-list--form"><input type="email" class="input input--undefined" name="email" placeholder="your@email.com" style="width:150px"><button class="button button--primary button--undefined" type="submit">Subscribe </button></form></div></div><div><a href="https://twitter.com/timberdotio" target="_blank"><i class="feather icon-twitter" alt="Vector&#x27;s Twitter"></i></a>    <a href="https://chat.vector.dev" target="_blank"><i class="feather icon-message-circle" alt="Vector&#x27;s Chat"></i></a>    <a href="https://github.com/timberio/vector" target="_blank"><i class="feather icon-github" alt="Vector&#x27;s Github Repo"></i></a>    <a href="https://vector.dev/blog/atom.xml" target="_blank"><i class="feather icon-rss" alt="Vector&#x27;s RSS feed"></i></a></div></div><div class="col footer__col"><h4 class="footer__title">About</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/about/what-is-brainrex/">What is BrainRex?</a></li><li class="footer__item"><a class="footer__link-item" href="/contact/">Contact Us</a></li><li class="footer__item"><a class="footer__link-item" href="/press/">Press Kit</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Components</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/reference/sources/">Sources</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/reference/transforms/">Transforms</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/reference/sinks/">Sinks</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Setup</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/setup/installation/">Install</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/setup/deployment/">Deployment</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/setup/configuration/">Configuration</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/administration/">Administration</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" to="https://t.me/brainrex" href="https://t.me/brainrex">Chat</a></li><li class="footer__item"><a class="footer__link-item" to="https://github.com/brainrexAPI" href="https://github.com/brainrexAPI">Github</a></li><li class="footer__item"><a class="footer__link-item" to="https://twitter.com/brainrexAPI" href="https://twitter.com/brainrexAPI">Twitter</a></li><li class="footer__item"><a class="footer__link-item" href="/mailing_list/">Mailing List</a></li><li class="footer__item"><a aria-current="page" class="footer__link-item active" href="/blog/">Blog</a></li></ul></div></div><div class="text--center"><div class="margin-bottom--sm"><a href="https://brainrex.com/" target="_blank" rel="noopener noreferrer" class="footerLogoLink_3L_r"></a></div>Copyright © 2020 BrainRex, Ltd.</div></div></footer>
</div>

<script src="/styles.5d12b271.js"></script>

<script src="/runtime~main.4b271833.js"></script>

<script src="/main.d363e7bf.js"></script>

<script src="/common.f3c80ee9.js"></script>

<script src="/2.ddc1eefb.js"></script>

<script src="/ccc49370.78ac6720.js"></script>

<script src="/b25784ee.dda500e8.js"></script>


</body>
</html>